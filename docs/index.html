<!DOCTYPE html>

<html lang="en">
  <head>
    <title>mtgoupdate</title>
    <!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-8HF2HRS1RS"></script>
	<script>
  		window.dataLayer = window.dataLayer || [];
  		function gtag(){dataLayer.push(arguments);}
  		gtag('js', new Date());

  		gtag('config', 'G-8HF2HRS1RS');
	</script>
  </head>
  <style>
  	h1 {
  		text-align: center;
  	}
  	#info {
  		position: absolute;
  		top: 10px;
  		right: 10px;
  		font-size: 24px;
  	}
  	.bottom {
  		position: fixed;
  		bottom: 0;
  		width: 100%;
  		text-align: center;
  	}
  	.modal {
  		display: none;
  		position: fixed;
  		z-index: 1;
  		left: 0;
  		top: 0;
  		width: 100%;
  		height: 100%;
  		overflow: auto;
  		background-color: rgb(0,0,0);
  		background-color: rgba(0,0,0,0.4);
	}
	.modal-content {
	background-color: #fefefe;
	margin: 5% auto;
	padding: 20px;
	border: 1px solid #888;
	width: 80%;
	}
	.everything {
		display: flex;
		position: relative;
		justify-content: space-between;
		flex-direction: column;
		height: 100vh;
	}
	.container {
		display: flex;
		justify-content: center;
		gap: 8px 4px;
		flex-wrap: wrap;
	}
	.footer {
		bottom: 0;
		text-align: center;
	}
	.close {
		color: #aaa;
		float: right;
		font-size: 28px;
		font-weight: bold;
	}
	.close:hover,
	.close:focus {
		color: black;
		text-decoration: none;
		cursor: pointer;
	}
	body {
		margin: 0;
		padding: 0;
	}
</style>
  <body>
  	<noscript><div>Please enable JavaScript</div></noscript>
    <script type="text/javascript">
    var today = new Date();
    var localTime = today.toString();
    var PTOffset;
    var nextDST;
    if (today.getTime() <= 1678611600000) {  // handles DST switch in March 2023
    	PTOffset = 8;
    	if (today.getFullYear() == "2022") {
    		nextDST = "March 12th, 2023";
    	} else {
    		nextDST = "March 12th";
    	}
    } else {
    	PTOffset = 7;
    	nextDST = "November 5th";
    }
    document.write(`
    <div class="everything">
    <div><div>
    <h1>Scheduled Events on MTGO</h1>
    <button id="info">&#8505;</button>
    <div id="faq" class="modal">
    	<div class="modal-content">
    		<span class="close">&times;</span>
    		<p>
    		<b>FAQ</b><br><br>
    		<b>What is this website for?</b><br><br>
    		It's hard to know when scheduled events are being held on MTGO. This site provides that information to you in your home time zone.<br><br>
    		
    		<b>I'm viewing this page right before my country changes its clocks for Daylight Saving Time.
    		Are events that take place after the switch listed at the correct times?</b><br><br>
    		
    		No. Anticipating when your locale enters or exits DST would require me to obsessively monitor hundreds of legislatures for changes
    		 in policy and to take a side in numerous territorial disputes around the world.<br><br>
    		 
    		<b>I'm viewing this page right before the US changes its clocks for DST (but I won't be changing mine).
    		Are events that take place after the switch listed at the correct times?</b><br><br>
    		
    		No. While the US's time change is predictable to me in advance, your locale's lack of a change is not (see above). Check back after the US changes its clocks (next happening at 2am on ${nextDST}).<br><br>

			<b>What's your contact information?</b><br><br>
			
			Feel free to message me on Twitter @mtgoupdate or email me at admin at mtgoupdate dot com.<br><br>
			
			<b>You seem like a cool person and I've benefited from the work you've done. Will you please take my money?</b><br><br>
			
			Gladly. You can tip me at <a href="https://www.ko-fi.com/mtgoupdate">ko-fi.com/mtgoupdate</a> or email me about sending me MTGO tickets.<br><br>
			</p>
    	</div>
    </div>
    `);
    var offset =  PTOffset - Math.floor(today.getTimezoneOffset() / 60);
    var minuteOffset = today.getTimezoneOffset() % 60;
    if (minuteOffset != 0) {
    	if (minuteOffset > 0) {
    		// Localities like St. John's with fractional offsets that are west of Greenwich have getTimezoneOffset() > 0.
    		// Instead of e.g. "3 hours and 45 minutes behind Greenwich",
    		// this is more naturally thought of as "4 hours behind and 15 minutes ahead of Greenwich".
    		// Because we incremented the integer part of the time difference (represented above by the floor), we have to decrement offset.
    		minuteOffset = 60 - minuteOffset;
    		offset--;
    	} else {
    		// Localities like Central Australia with fractional offsets that are east of Greenwich have getTimezoneOffset() < 0.
    		// A minuteOffset of e.g. -15 here means 15 minutes ahead of Greenwich, so we have to negate that variable.
    		// Offset is decremented because floor() rounds towards -infinity, when we want it to round towards 0;
    		// for non-integers this results in an off-by-one error.
    		minuteOffset = -minuteOffset;
    		offset--;
    	}
    }
    const schedule = getSchedule();
    document.write("<div class=\"container\">");
    for (let k = 0; k < 7; k++) {
     	document.write(generateTextboxForDay(today, minuteOffset));
	   	today.setDate(today.getDate() + 1);
    }
    document.write("</div><center><p><strong>Detected local time:</strong> " + localTime + "</p></center></div>");
    document.write("</div>"); // container
    document.write("<p class=\"footer\">Domain names and time aren't free. <a href=\"https://www.ko-fi.com/mtgoupdate\">Donate</a> if you wish.</p>");
    document.write("</div>"); // everything
      
    setUpFaqModal();
      
	function getScheduleForDay(day, minuteOffset) {
		let i = day.getDay(); // of week
		let ret = "";
		let upperLimit = (minuteOffset == 0) ? 24 : 23;
    	for (let j = 0; j <= upperLimit; j++) {
     		let prettyTime = getPrettyTime(j, minuteOffset);
     		let k = ((24 * i + j) - offset + 168) % 168;
     		let events = (schedule[k] == null) ? [null] : schedule[k].split("&");
     		for (let index = 0; index < events.length; index++) {
     			let event = events[index];
     			if (event != null) {
     				color = "black";
     				if (j == 24) {
     					color = "grey";
     				} else if (isPremier(event) || event.includes("Eternal Weekend")) {
     					color = "red";
     				} else if (event.includes("Challenge")) {
     					color = "green";
     				}
     				ret += "<font color=" + color + ">" + prettyTime + " " + event + "</font><br>";
     			}
     		}
     	}
     	return ret;
	}
     
	function getSchedule() {
	    let ch = "Challenge";
	    let pr = "Prelim";
		let ret = [null, "Eternal Weekend - Vintage&Limited Challenge (32-player)", null, null, `Modern ${ch}`, null, `Pioneer ${ch}`, null, `Legacy ${ch}`, null, `Pauper ${ch}`, null,
    		"Limited Challenge", null, `Standard ${ch}`, `Vintage ${pr}`, `Limited ${pr}`, null, null, null, null, null, null, null,
    		`Pioneer ${pr}`, null, null, `Limited ${pr}`, null, null, null, `Modern ${pr}`, null, `Limited ${pr}`, null, `Legacy ${pr}`,
    		null, null, null, `Modern ${pr}`, null, null, `Limited ${pr}`, `Pioneer ${pr}`, null, null, null, null,
    		`Limited ${pr}`, null, null, `Modern ${pr}`, null, null, null, `Pioneer ${pr}`, null, `Limited ${pr}`, null, `Modern ${pr}`,
    		null, null, null, `Pioneer ${pr}`, `Limited ${pr}`, null, null, `Legacy ${pr}`, null, null, null, null,
    		`Limited ${pr}`, null, null, `Legacy ${pr}`, null, null, null, `Limited ${pr}`, null, null, null, `Pioneer ${pr}`,
   			null, null, null, `Modern ${pr}`, `Limited ${pr}`, null, null, null, null, `Limited ${pr}`, null, null,
    		`Modern ${pr}`, null, null, `Pioneer ${pr}`, null, null, null, `Limited ${pr}`, null, null, null, `Modern ${pr}`,
    		`Limited ${pr}`, null, null, `Legacy ${pr}`, `Limited ${pr}`, null, null, `Modern ${pr}`, null, `Pioneer ${pr}`, null, null,
    		`Legacy ${pr}`, null, `Limited ${pr}`, null, `Modern ${pr}`, null, null, `Legacy ${pr}`, null, null, `Limited ${pr}`, `Vintage ${pr}`,
    		null, null, null, `Pioneer ${pr}`, null, null, `Limited ${pr}`, `Modern ${pr}`, null, null, null, null,
    		`Pioneer ${pr}`, "Eternal Weekend - Legacy&Limited Challenge (32-player)", `Pauper ${ch}`, null, `Legacy ${ch} (32-player)`, null, `Standard ${ch}`, null, `Modern ${ch}`, null, `Vintage ${ch}`, null,
    		"Limited Challenge", null, `Pioneer ${ch}`, null, `Limited ${pr}`, null, null, null, null, null, null, null];
    	insertSpecialEventsAndLCQs(ret);
    	return ret;
    }
    
    function insertSpecialEventsAndLCQs(schedule) {
    	let events = getSpecialEvents();
    }
    
    function getSpecialEvents() {
    	let ret = new Map();
    	return ret;
    }
	
	function isPremier(event) {
		return event.includes("Qualifier") || event.includes("Showcase") || event.includes("LCQ");
	}
	
	function isMocsFormat(str) {
		return str.includes("Pioneer") || str.includes("Modern") || str.includes("Legacy") ||  str.includes("Vintage");
	}
	
	function getPrettyTime(hour, minuteOfHour) {
		if (minuteOfHour == 0) {
     		if (hour == 0) {
     			return "12am";
     		} else if (hour < 12) {
     			return hour + "am";
     		} else if (hour == 12) {
     			return "Noon";
     		} else if (hour < 24) {
     			return (hour - 12) + "pm";
     		} else {
     			return "Midnight";
     		}
     	} else {
     		if (hour == 0) {
     			return "12:" + minuteOfHour + "am";
     		} else if (hour < 12) {
     			return hour + ":" + minuteOfHour + "am";
     		} else if (hour == 12) {
     			return hour + ":" + minuteOfHour + "pm";
     		} else if (hour < 24) {
     			return (hour - 12) + ":" + minuteOfHour + "pm";
     		} else {
     			return ""; // shouldn't happen
     		}
     	}
	}
	
	function generateTextboxForDay(today, minuteOffset) {
     	let color = (today.getDay() == 0 || today.getDay() == 6) ? "blue" : "black"; // blue indicates weekend
     	let suffix = "th";
     	if (today.getDate() % 20 == 1 || today.getDate() == 31) {
     		suffix = "st";
     	} else if (today.getDate() % 20 == 2) {
     		suffix = "nd";
     	} else if (today.getDate() % 20 == 3) {
     		suffix = "rd";
     	}
		const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
		return "<fieldset style=\"border: 1px " + color + " solid; display: inline-block; min-width: 280px;\">"
     			+ "<legend style=\"border: 1px " + color + " solid;margin-left: 1em; border-radius: 15px; padding: 0.2em 0.8em \">"
     			+ days[today.getDay()] + " " + today.getDate() + suffix + "</legend>"
     			+ getScheduleForDay(today, minuteOffset)
     			+ "</fieldset>";
	}
	
	function setUpFaqModal() {
		var modal = document.getElementById("faq");
    	var button = document.getElementById("info");
   		var span = document.getElementsByClassName("close")[0];

    	button.onclick = function() { modal.style.display = "block"; };
    	span.onclick = function() { modal.style.display = "none"; };
    	window.onclick = function(event) { if(event.target == modal) { modal.style.display = "none"; }};poop
	}
   </script>
  </body>
</html>