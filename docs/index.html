<!DOCTYPE html>

<html lang="en">
  <head>
    <title>mtgoupdate</title>
    <!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-8HF2HRS1RS"></script>
	<script>
  		window.dataLayer = window.dataLayer || [];
  		function gtag(){dataLayer.push(arguments);}
  		gtag('js', new Date());

  		gtag('config', 'G-8HF2HRS1RS');
	</script>
  </head>
  <style>
  	h1 {
  		text-align: center;
  	}
  	#info {
  		position: absolute;
  		top: 10px;
  		right: 10px;
  		font-size: 24px;
  	}
  	.bottom {
  		position: fixed;
  		bottom: 0;
  		width: 100%;
  		text-align: center;
  	}
  	.modal {
  		display: none;
  		position: fixed;
  		z-index: 1;
  		left: 0;
  		top: 0;
  		width: 100%;
  		height: 100%;
  		overflow: auto;
  		background-color: rgb(0,0,0);
  		background-color: rgba(0,0,0,0.4);
	}
	.modal-content {
	background-color: #fefefe;
	margin: 5% auto;
	padding: 20px;
	border: 1px solid #888;
	width: 80%;
	}
	.everything {
		display: flex;
		position: relative;
		justify-content: space-between;
		flex-direction: column;
		height: 100vh;
	}
	.container {
		display: flex;
		justify-content: center;
		gap: 8px 4px;
		flex-wrap: wrap;
	}
	.footer {
		bottom: 0;
		text-align: center;
	}
	.close {
		color: #aaa;
		float: right;
		font-size: 28px;
		font-weight: bold;
	}
	.close:hover,
	.close:focus {
		color: black;
		text-decoration: none;
		cursor: pointer;
	}
	body {
		margin: 0;
		padding: 0;
	}
</style>
  <body>
  	<noscript><div>Please enable JavaScript</div></noscript>
    <script type="text/javascript">
    var today = new Date();
    var localTime = today.toString();
    var PTOffset;
    var nextDST;
    if (today.getTime() <= 1678611600000) {  // handles DST switch in March 2023
    	PTOffset = 8;
    	if (today.getFullYear() == "2022") {
    		nextDST = "March 12th, 2023";
    	} else {
    		nextDST = "March 12th";
    	}
    } else {
    	PTOffset = 7;
    	nextDST = "November 5th";
    }
    document.write(`
    <div class="everything">
    <div><div>
    <h1>Scheduled Events on MTGO</h1>
    <button id="info">&#8505;</button>
    <div id="faq" class="modal">
    	<div class="modal-content">
    		<span class="close">&times;</span>
    		<p>
    		<b>FAQ</b><br><br>
    		<b>What is this website for?</b><br><br>
    		It's hard to know when scheduled events are being held on MTGO. This site provides that information to you in your home time zone.<br><br>
    		
    		<b>I'm viewing this page right before my country changes its clocks for Daylight Saving Time.
    		Are events that take place after the switch listed at the correct times?</b><br><br>
    		
    		No. Anticipating when your locale enters or exits DST would require me to obsessively monitor hundreds of legislatures for changes
    		 in policy and to take a side in numerous territorial disputes around the world.<br><br>
    		 
    		<b>I'm viewing this page right before the US changes its clocks for DST (but I won't be changing mine).
    		Are events that take place after the switch listed at the correct times?</b><br><br>
    		
    		No. While the US's time change is predictable to me in advance, your locale's lack of a change is not (see above). Check back after the US changes its clocks (next happening at 2am on ${nextDST}).<br><br>

			<b>What's your contact information?</b><br><br>
			
			Feel free to message me on Twitter @mtgoupdate or email me at admin at mtgoupdate dot com.<br><br>
			
			<b>You seem like a cool person and I've benefited from the work you've done. Will you please take my money?</b><br><br>
			
			Gladly. You can tip me at <a href="https://www.ko-fi.com/mtgoupdate">ko-fi.com/mtgoupdate</a> or email me about sending me MTGO tickets.<br><br>
			</p>
    	</div>
    </div>
    `);
    var offset =  PTOffset - Math.floor(today.getTimezoneOffset() / 60);
    var minuteOffset = today.getTimezoneOffset() % 60;
    if (minuteOffset != 0) {
    	if (minuteOffset > 0) {
    		// Localities like St. John's with fractional offsets that are west of Greenwich have getTimezoneOffset() > 0.
    		// Instead of e.g. "3 hours and 45 minutes behind Greenwich",
    		// this is more naturally thought of as "4 hours behind and 15 minutes ahead of Greenwich".
    		// Because we incremented the integer part of the time difference (represented above by the floor), we have to decrement offset.
    		minuteOffset = 60 - minuteOffset;
    		offset--;
    	} else {
    		// Localities like Central Australia with fractional offsets that are east of Greenwich have getTimezoneOffset() < 0.
    		// A minuteOffset of e.g. -15 here means 15 minutes ahead of Greenwich, so we have to negate that variable.
    		// Offset is decremented because floor() rounds towards -infinity, when we want it to round towards 0;
    		// for non-integers this results in an off-by-one error.
    		minuteOffset = -minuteOffset;
    		offset--;
    	}
    }
    var fallbacks = {};
    const schedule = getSchedule();
    document.write("<div class=\"container\">");
    for (let k = 0; k < 7; k++) {
     	document.write(generateTextboxForDay(today, fallbacks, minuteOffset));
	   	today.setDate(today.getDate() + 1);
    }
    document.write("</div><center><p><strong>Detected local time:</strong> " + localTime + "</p></center></div>");
    document.write("</div>"); // container
    document.write("<p class=\"footer\">Domain names and time aren't free. <a href=\"https://www.ko-fi.com/mtgoupdate\">Donate</a> if you wish.</p>");
    document.write("</div>"); // everything
      
    setUpFaqModal();
      
	function getScheduleForDay(day, fallbacks, minuteOffset) {
		let i = day.getDay(); // of week
		let ret = "";
		let upperLimit = (minuteOffset == 0) ? 24 : 23;
    	for (let j = 0; j <= upperLimit; j++) {
     		let prettyTime = getPrettyTime(j, minuteOffset);
     		let k = ((24 * i + j) - offset + 168) % 168;
     		let events = (schedule[k] == null) ? [null] : schedule[k].split("&");
     		for (let index = 0; index < events.length; index++) {
     			let event = events[index];
     			if (event != null && isPremier(event) && !areConsecutiveOrSame(day, fallbacks[k][0])) {
     				event = fallbacks[k][1];
     			}
     			if (event != null) {
     				color = "black";
     				if (j == 24) {
     					color = "grey";
     				} else if (isPremier(event) || event.includes("Eternal Weekend")) {
     					color = "red";
     				} else if (event.includes("Challenge")) {
     					color = "green";
     				}
     				ret += "<font color=" + color + ">" + prettyTime + " " + event + "</font><br>";
     			}
     		}
     	}
     	return ret;
	}
     
	function getSchedule() {
	    let ch = "Challenge";
	    let pr = "Prelim";
		let ret = [null, "Eternal Weekend - Vintage&Limited Challenge (32-player)", null, null, `Modern ${ch}`, null, `Pioneer ${ch}`, null, `Legacy ${ch}`, null, `Pauper ${ch}`, null,
    		"Limited Challenge", null, `Standard ${ch}`, `Vintage ${pr}`, `Limited ${pr}`, null, null, null, null, null, null, null,
    		`Pioneer ${pr}`, null, null, `Limited ${pr}`, null, null, null, `Modern ${pr}`, null, `Limited ${pr}`, null, `Legacy ${pr}`,
    		null, null, null, `Modern ${pr}`, null, null, `Limited ${pr}`, `Pioneer ${pr}`, null, null, null, null,
    		`Limited ${pr}`, null, null, `Modern ${pr}`, null, null, null, `Pioneer ${pr}`, null, `Limited ${pr}`, null, `Modern ${pr}`,
    		null, null, null, `Pioneer ${pr}`, `Limited ${pr}`, null, null, `Legacy ${pr}`, null, null, null, null,
    		`Limited ${pr}`, null, null, `Legacy ${pr}`, null, null, null, `Limited ${pr}`, null, null, null, `Pioneer ${pr}`,
   			null, null, null, `Modern ${pr}`, `Limited ${pr}`, null, null, null, null, `Limited ${pr}`, null, null,
    		`Modern ${pr}`, null, null, `Pioneer ${pr}`, null, null, null, `Limited ${pr}`, null, null, null, `Modern ${pr}`,
    		`Limited ${pr}`, null, null, `Legacy ${pr}`, `Limited ${pr}`, null, null, `Modern ${pr}`, null, `Pioneer ${pr}`, null, null,
    		`Legacy ${pr}`, null, `Limited ${pr}`, null, `Modern ${pr}`, null, null, `Legacy ${pr}`, null, null, `Limited ${pr}`, `Vintage ${pr}`,
    		null, null, null, `Pioneer ${pr}`, null, null, `Limited ${pr}`, `Modern ${pr}`, null, null, null, null,
    		`Pioneer ${pr}`, "Eternal Weekend - Legacy&Limited Challenge (32-player)", `Pauper ${ch}`, null, `Legacy ${ch} (32-player)`, null, `Standard ${ch}`, null, `Modern ${ch}`, null, `Vintage ${ch}`, null,
    		"Limited Challenge", null, `Pioneer ${ch}`, null, `Limited ${pr}`, null, null, null, null, null, null, null];
    	modifyScheduleAndAddFallbacks(ret);
    	return ret;
    }
    
    function modifyScheduleAndAddFallbacks(schedule) {
    	// 1am Sunday
    	schedule[1] = "Limited (NEO) Super Qualifier&" + schedule[1];
    	fallbacks[1] = [new Date(2023, 2, 5, 9), null];
    	
    	// 6am Sunday
    	schedule[6] = "Pioneer Showcase Challenge";
    	let pioFallbackDate = null;
    	if (today.getTime() < new Date(2023, 0, 10, 14).getTime()) {
    		pioFallbackDate = new Date(2023, 0, 8, 14);
    	} else if (today.getTime() < new Date(2023, 1, 14, 13).getTime()) {
    		pioFallbackDate = new Date(2023, 1, 12, 14);
    	} else {
    		pioFallbackDate = new Date(2023, 2, 12, 14);
    	}
    	fallbacks[6] = [pioFallbackDate, "Pioneer Challenge"];
    	
    	if (today.getTime() < new Date(2022, 11, 20, 15).getTime()) {
    		schedule[7] = "Limited (BRO) MOCS Showcase Open";
    		fallbacks[7] = [new Date(2022, 11, 18, 15), null];
    	} else if (today.getTime() < new Date(2023, 0, 20, 16).getTime()) {
    		schedule[7] = "Limited (BRO) Super Qualifier";
    		fallbacks[7] = [new Date(2023, 0, 22, 15), null];
    	} else if (today.getTime() < new Date(2023, 0, 27, 16).getTime()) {
    		schedule[7] = "Limited (BRO) Super Qualifier";
    		fallbacks[7] = [new Date(2023, 0, 22, 15), "Vintage Super Qualifier"];
    	} else if (today.getTime() < new Date(2023, 1, 3, 16).getTime()) {
    		schedule[7] = "Vintage Super Qualifier";
    		fallbacks[7] = [new Date(2023, 0, 29, 15), "Standard Super Qualifier"];
    	} else if (today.getTime() < new Date(2023, 1, 7, 16).getTime()) {
    		schedule[7] = "Standard Super Qualifier";
    		fallbacks[7] = [new Date(2023, 1, 5, 15), null];
    	} else {
    		schedule[7] = "Limited (ONE) Super Qualifier";
    		fallbacks[7] = [new Date(2023, 1, 19, 15), null];
    	}

		// 8am Sunday
		schedule[8] = "Legacy Showcase Challenge";
		let legFallbackDate = null;
		if (today.getTime() < new Date(2023, 0, 17, 16).getTime()) {
			legFallbackDate = new Date(2023, 0, 15, 16);
		} else if (today.getTime() < new Date(2023, 1, 28, 16).getTime()) {
			legFallbackDate = new Date(2023, 1, 26, 16);
		}else {
			legFallbackDate = new Date(2023, 2, 19, 16);
		}
		fallbacks[8] = [legFallbackDate, "Legacy Challenge"];
		
		// Noon Sunday
		schedule[12] = "Modern Super Qualifier&" + schedule[12];
		fallbacks[12] = [new Date(2023, 2, 5, 20), null];
    	
    	// 3pm Sunday
    	schedule[15] = "Limited (BRO) Qualifier&" + schedule[15];
    	fallbacks[15] = [new Date(2023, 0, 1, 23), null];
    	// TODO remove this after it occurs so it doesn't show up during LCQ season
    	
    	// 7am Monday
    	if (today.getTime() < new Date(2022, 11, 28, 15).getTime()) {
    		schedule[31] = "Modern Super Qualifier&" + schedule[31];
    		fallbacks[31] = [new Date(2022, 11, 26, 15), null];
    	} else {
    		schedule[31] = "Limited (ONE) Qualifier&" + schedule[31];
    		fallbacks[31] = [new Date(2023, 1, 20, 15), null];
    		// TODO remove this after it occurs so it doesn't show up during LCQ season
    	}
    	
    	// 7am Tuesday
    	schedule[55] = "Standard Super Qualifier&" + schedule[55];
    	fallbacks[55] = [new Date(2022, 11, 27, 15), null];
    	// TODO remove this after it occurs so it doesn't show up during LCQ season

    	// 7am Wednesday
    	schedule[79] = "Pioneer Super Qualifier&" + schedule[79];
    	fallbacks[79] = [new Date(2022, 11, 28, 15), null];
    	
    	// 7am Thursday
    	schedule[103] = "Legacy Super Qualifier&" + schedule[103];
    	fallbacks[103] = [new Date(2022, 11, 29, 15), null];
    	
    	// Friday 7am
    	if (today.getTime() < new Date(2022, 11, 4, 15)) {
    		schedule[127] = "Limited (BRO) Super Qualifier&" + schedule[127];
    		fallbacks[127] = [new Date(2022, 11, 2, 15), null];
    	} else if (today.getTime() < new Date(2022, 11, 18, 15)) {
    		schedule[127] = "Limited (BRO) Super Qualifier&" + schedule[127];
    		fallbacks[127] = [new Date(2022, 11, 23, 15), null];
    	} else if (today.getTime() < new Date(2022, 11, 25, 15)) {
    		schedule[127] = "Limited (BRO) Super Qualifier&" + schedule[127];
    		fallbacks[127] = [new Date(2022, 11, 23, 15), "Vintage Super Qualifier"];
    	} else if (today.getTime() < new Date(2023, 0, 1, 15)) {
    		schedule[127] = "Vintage Super Qualifier&" + schedule[127];
    		fallbacks[127] = [new Date(2022, 11, 30, 15), null];
    	} else {
    		schedule[127] = "Limited (ONE) Super Qualifier&" + schedule[127];
    		fallbacks[127] = [new Date(2023, 2, 17, 14), null];
    	}
    	
    	// Friday 2pm
    	if (today.getTime() < new Date(2023, 1, 12, 22)) {
    		schedule[134] = "Limited (ONE) Qualifier";
    		fallbacks[134] = [new Date(2023, 1, 10, 22), null];
    	} else {
    		schedule[134] = "Limited (ONE) Qualifier";
    		fallbacks[134] = [new Date(2023, 2, 10, 22), null];
    	}
    	
    	// Saturday 12am
    	schedule[144] = "Standard Qualifier&" + schedule[144];
    	fallbacks[144] = [new Date(2022, 9, 29, 7), null];
    	
    	// Saturday 6am
		schedule[150] = "Standard Showcase Challenge";
		let stdFallbackDate = null;
    	if (today.getTime() < new Date(2022, 9, 1, 15).getTime()) {
			stdFallbackDate = new Date(2022, 8, 24, 13);
		} else if (today.getTime() < new Date(2022, 10, 10, 15).getTime()) {
			stdFallbackDate = new Date(2022, 10, 5, 13);
		} else {
			stdFallbackDate = new Date(2022, 10, 26, 14);
		}
    	fallbacks[150] = [stdFallbackDate, "Standard Challenge"];
    	
    	// Saturday 7am
    	if (today.getTime() < new Date(2022, 11, 19, 15).getTime()) {
    		schedule[151] = "Limited (BRO) MOCS Showcase Open";
    		fallbacks[151] = [new Date(2022, 11, 17, 15), null];
    	} else if (today.getTime() < new Date(2023, 0, 16, 15).getTime()) {
    		schedule[151] = "Modern Super Qualifier";
    		fallbacks[151] = [new Date(2023, 0, 21, 15), null];
    	} else if (today.getTime() < new Date(2023, 0, 23, 15).getTime()) {
    		schedule[151] = "Modern Super Qualifier";
    		fallbacks[151] = [new Date(2023, 0, 21, 15), "Pauper Qualifier"];
    	} else if (today.getTime() < new Date(2023, 0, 30, 15).getTime()) {
    		schedule[151] = "Pauper Qualifier";
    		fallbacks[151] = [new Date(2023, 0, 28, 15), "Legacy Qualifier"];
    	} else if (today.getTime() < new Date(2023, 1, 6, 15).getTime()) {
    		schedule[151] = "Legacy Qualifier";
    		fallbacks[151] = [new Date(2023, 1, 4, 15), null];
    	} else if (today.getTime() < new Date(2023, 1, 20, 15).getTime()) {
    		schedule[151] = "Pioneer Super Qualifier";
    		fallbacks[151] = [new Date(2023, 1, 18, 15), null];
    	} else {
    		schedule[151] = "Limited (NEO) Super Qualifier";
    		fallbacks[151] = [new Date(2023, 2, 4, 15), null];
    	}
    	
    	// Saturday 8am
    	schedule[152] = "Modern Showcase Challenge";
    	let modFallbackDate = null;
    	if (today.getTime() < new Date(2023, 0, 9, 16).getTime()) {
			modFallbackDate = new Date(2023, 0, 7, 16);
		} else if (today.getTime() < new Date(2023, 1, 13, 16).getTime()) {
			modFallbackDate = new Date(2023, 1, 11, 16);
		}else {
			modFallbackDate = new Date(2023, 2, 11, 16);
		}
    	fallbacks[152] = [modFallbackDate, "Modern Challenge"];
    	
    	// Saturday 10am
    	schedule[154] = "Vintage Showcase Challenge";
    	let vintFallbackDate = null;
    	if (today.getTime() < new Date(2023, 0, 16, 18).getTime()) {
			vintFallbackDate = new Date(2023, 0, 14, 18);
		} else if (today.getTime() < new Date(2023, 1, 27, 18).getTime()) {
			vintFallbackDate = new Date(2023, 1, 25, 18);
		}else {
			vintFallbackDate = new Date(2023, 2, 18, 18);
		}
    	fallbacks[154] = [vintFallbackDate, "Vintage Challenge"];
		
		// LCQs (various)			
		for (let i = 0; i < 79; i++) {
			if ((schedule[i] != null) && isMocsFormat(schedule[i]) && schedule[i].includes("Prelim") && !isPremier(schedule[i])) {
				let temp = schedule[i];
				schedule[i] = schedule[i].replace("Prelim", "LCQ");
				fallbacks[i] = [new Date(2023, 2, 21, 1), temp];
    			// Tuesday 1am UTC is sneakily within 48 hours of every LCQ, which is the grace period given in the function below
			}
		}
    }
    
    function areConsecutiveOrSame(date1, date2) {
		return isSameDayOrJustAfter(date1, date2) || isSameDayOrJustAfter(date2, date1);
	}
	
	function isSameDayOrJustAfter(date1, date2) {
		return (date1 <= date2) && (date2 <= (new Date(date1)).setDate(date1.getDate() + 2));
	}
	
	function isPremier(event) {
		return event.includes("Qualifier") || event.includes("Showcase") || event.includes("LCQ");
	}
	
	function isMocsFormat(str) {
		return str.includes("Pioneer") || str.includes("Modern") || str.includes("Legacy") ||  str.includes("Vintage");
	}
	
	function getPrettyTime(hour, minuteOfHour) {
		if (minuteOfHour == 0) {
     		if (hour == 0) {
     			return "12am";
     		} else if (hour < 12) {
     			return hour + "am";
     		} else if (hour == 12) {
     			return "Noon";
     		} else if (hour < 24) {
     			return (hour - 12) + "pm";
     		} else {
     			return "Midnight";
     		}
     	} else {
     		if (hour == 0) {
     			return "12:" + minuteOfHour + "am";
     		} else if (hour < 12) {
     			return hour + ":" + minuteOfHour + "am";
     		} else if (hour == 12) {
     			return hour + ":" + minuteOfHour + "pm";
     		} else if (hour < 24) {
     			return (hour - 12) + ":" + minuteOfHour + "pm";
     		} else {
     			return ""; // shouldn't happen
     		}
     	}
	}
	
	function generateTextboxForDay(today, fallbacks, minuteOffset) {
     	let color = (today.getDay() == 0 || today.getDay() == 6) ? "blue" : "black"; // blue indicates weekend
     	let suffix = "th";
     	if (today.getDate() % 20 == 1 || today.getDate() == 31) {
     		suffix = "st";
     	} else if (today.getDate() % 20 == 2) {
     		suffix = "nd";
     	} else if (today.getDate() % 20 == 3) {
     		suffix = "rd";
     	}
		const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
		return "<fieldset style=\"border: 1px " + color + " solid; display: inline-block; min-width: 280px;\">"
     			+ "<legend style=\"border: 1px " + color + " solid;margin-left: 1em; border-radius: 15px; padding: 0.2em 0.8em \">"
     			+ days[today.getDay()] + " " + today.getDate() + suffix + "</legend>"
     			+ getScheduleForDay(today, fallbacks, minuteOffset)
     			+ "</fieldset>";
	}
	
	function setUpFaqModal() {
		var modal = document.getElementById("faq");
    	var button = document.getElementById("info");
   		var span = document.getElementsByClassName("close")[0];

    	button.onclick = function() { modal.style.display = "block"; };
    	span.onclick = function() { modal.style.display = "none"; };
    	window.onclick = function(event) { if(event.target == modal) { modal.style.display = "none"; }};poop
	}
   </script>
  </body>
</html>