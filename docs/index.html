<!DOCTYPE html>

<html lang="en">
  <head>
    <title>mtgoupdate</title>
    <!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-8HF2HRS1RS"></script>
	<script>
  		window.dataLayer = window.dataLayer || [];
  		function gtag(){dataLayer.push(arguments);}
  		gtag('js', new Date());

  		gtag('config', 'G-8HF2HRS1RS');
	</script>
  </head>
  <style>
  	h1 {
  		text-align: center;
  	}
  	#info {
  		position: absolute;
  		top: 10px;
  		right: 10px;
  		font-size: 24px;
  	}
  	.bottom {
  		position: fixed;
  		bottom: 0;
  		width: 100%;
  		text-align: center;
  	}
  	.modal {
  		display: none;
  		position: fixed;
  		z-index: 1;
  		left: 0;
  		top: 0;
  		width: 100%;
  		height: 100%;
  		overflow: auto;
  		background-color: rgb(0,0,0);
  		background-color: rgba(0,0,0,0.4);
	}
	.modal-content {
	background-color: #fefefe;
	margin: 5% auto;
	padding: 20px;
	border: 1px solid #888;
	width: 80%;
	}
	.everything {
		display: flex;
		position: relative;
		justify-content: space-between;
		flex-direction: column;
		height: 100vh;
	}
	.container {
		display: flex;
		justify-content: center;
		gap: 8px 4px;
		flex-wrap: wrap;
	}
	.footer {
		bottom: 0;
		text-align: center;
	}
	.close {
		color: #aaa;
		float: right;
		font-size: 28px;
		font-weight: bold;
	}
	.close:hover,
	.close:focus {
		color: black;
		text-decoration: none;
		cursor: pointer;
	}
	body {
		margin: 0;
		padding: 0;
	}
</style>
  <body>
  	<noscript><div>Please enable JavaScript</div></noscript>
    <div class="everything">
    <div><div>
    <h1>Scheduled Events on MTGO</h1>
    <button id="info">&#8505;</button>
    <div id="faq" class="modal">
    	<div class="modal-content">
    		<span class="close">&times;</span>
    		<p>
    		<b>FAQ</b><br><br>
    		<b>What is this website for?</b><br><br>
    		It's hard to know when scheduled events are being held on MTGO. This site provides that information to you in your home time zone.<br><br>

    		<b>I live outside the United States and am about to change my clocks for Daylight Saving Time, <i>or</i> the US is changing
    		its clocks soon but I live elsewhere and will not be changing mine. Is the information on this page accurate for after the change?</b><br><br>
    		
    		No. Check back again after the clocks change.<br><br>

			<b>I live in one of those extremely fancy time zones that's a half or quarter hour offset from GMT/UTC.
			Does your website work for me?</b><br><br>
			
			AAAAAAAAAAHHHHHHH<br><br>
			
			<b>That's not an answer.</b><br><br>
			The answer is no.<br><br>
			
			<b>Will that ever change?</b><br><br>
			For the sake of my sanity I really hope not. If you exist and deeply want this, <a href="mailto:admin at mtgoupdate dot com">email me</a> and we can talk about it.<br><br>
			
			<b>You seem like a cool person and I've benefited from the work you've done. Will you take my money?</b><br><br>
			
			Gladly. You can tip me at <a href="https://www.ko-fi.com/mtgoupdate">ko-fi.com/mtgoupdate</a>.<br><br>
			</p>
    	</div>
    </div>
    <script type="text/javascript">
    var today = new Date();
    var localTime = today.toString();
    var PTOffset = (today.getTime() > 1667725199000) ? 8 : 7; // handles DST switch in November 2022
    var offset =  PTOffset - Math.floor(today.getTimezoneOffset() / 60);
    var isClientSomeJerkFromAustralia = (today.getTimezoneOffset() % 60) != 0;
    var tuesdayMorning = 1657004401000; // 12:00:01am PDT July 5th, gentle hack to get the 7am Sunday premier event right (Modern SPTQ -> Limited SPTQ -> none)
    const schedule = getSchedule(today);
	
    let fallbacks = getFallbackEvents(today);
    document.write("<div class=\"container\">");
    for (let k = 0; k < 7; k++) {
     	document.write(generateTextboxForDay(today, fallbacks));
	   	today.setDate(today.getDate() + 1);
    }
    document.write("</div><center><p><strong>Detected local time:</strong> " + localTime + "</p></center></div>");
    if (isClientSomeJerkFromAustralia) {
    	document.write("<div><center><p><strong><font color=red>Warning:</font></strong> you appear to be in a time zone that is not an integer number of hours different from GMT/UTC."
    					+ " Times in the above schedule are rounded to the nearest hour.</p></center></div>");
    }
    document.write("</div>"); // container
    document.write("<p class=\"footer\">Domain names and time aren't free. <a href=\"https://www.ko-fi.com/mtgoupdate\">Donate</a> if you wish.</p>");
    document.write("</div>"); // everything
      
    setUpFaqModal();
      
	function getScheduleForDay(day, fallbacks) {
		let i = day.getDay(); // of week
		let ret = "";
    	for (let j = 0; j <= 24; j++) {
     		let prettyTime = "";
     		if (j == 0) {
     			prettyTime = "12am";
     		} else if (j < 12) {
     			prettyTime = j + "am";
     		} else if (j == 12) {
     			prettyTime = "Noon";
     		} else if (j < 24) {
     			prettyTime = (j - 12) + "pm";
     		} else {
     			prettyTime = "Midnight";
     		}
     		let k = ((24 * i + j) - offset + 168) % 168;
     		let events = (schedule[k] == null) ? [null] : schedule[k].split("&");
     		for (let index = 0; index < events.length; index++) {
     			let event = events[index];
     			if (event != null) {
     				if (isPremier(event)) {
     					if (!areConsecutiveOrSame(day, fallbacks[k][0])) {
     						event = fallbacks[k][1];
     					}
     				}
     			}
     			if (event != null) {
     				color = "black";
     				if (j == 24) {
     					color = "grey";
     				} else if (isPremier(event)) {
     					color = "red";
     				} else if (event.includes("Challenge")) {
     					color = "green";
     				}
     				ret += "<font color=" + color + ">" + prettyTime + " " + event + "</font><br>";
     			}
     		}
     	}
     	return ret;
	}
     
	function getSchedule(today) {
		let sunday7AmEvent = (today.getTime() < tuesdayMorning) ? "Modern Super Qualifier" : "Limited (SNC) Super Qualifier";
		return ["Vintage Challenge", null, null, null, "Modern Challenge", null, "Pioneer Challenge", sunday7AmEvent, "Legacy Challenge", null, "Pauper Challenge", null,
    		"Limited Prelim", null, "Standard Challenge", "Vintage Prelim", "Limited Prelim", null, null, null, null, null, null, null,
    		"Pioneer Prelim", null, null, "Limited Prelim", null, null, "Limited (SNC) Qualifier", "Modern Prelim", null, "Limited Prelim", null, "Legacy Prelim",
    		null, null, null, "Modern Prelim", null, null, "Limited Prelim", "Pioneer Prelim", null, "Vintage Prelim", null, null,
    		"Pauper Prelim", null, null, "Modern Prelim", null, null, null, "Pioneer Prelim", null, "Limited Prelim", null, "Pauper Prelim",
    		null, null, null, "Standard Prelim", "Limited Prelim", null, null, "Legacy Prelim", null, null, null, null,
    		"Limited Prelim", null, null, "Legacy Prelim", null, null, null, "Standard Prelim", null, null, null, "Pioneer Prelim",
   			null, null, null, "Modern Prelim", "Limited Prelim", null, null, "Vintage Prelim", null, null, null, null,
    		"Modern Prelim", null, null, "Pioneer Prelim", null, null, null, "Pauper Prelim", null, null, null, "Modern Prelim",
    		"Limited Prelim", null, null, "Legacy Prelim", "Limited Prelim", null, null, "Standard Prelim", null, "Pioneer Prelim", null, null,
    		"Legacy Prelim", null, "Limited Prelim", null, "Modern Prelim", null, null, "Legacy Prelim", null, null, "Limited Prelim", "Vintage Prelim",
    		null, null, "Limited (SNC) Qualifier", "Pioneer Prelim", null, null, "Limited Prelim", "Modern Prelim", null, null, null, null,
    		"Pioneer Prelim", "Limited (SNC) Qualifier&Limited Prelim", "Pauper Challenge", null, "Legacy Challenge (32-player)", null, "Standard Challenge", "Pioneer Super Qualifier", "Modern Challenge", null, "Vintage Challenge", null,
    		"Limited Prelim", null, "Pioneer Challenge", null, "Limited Prelim", null, null, null, null, null, null, null];
    }
    
    function getFallbackEvents(today) {
    	let dict = {};
    	let sunday7AmFallback = (today.getTime() < tuesdayMorning) ? "Limited (SNC) Super Qualifier"  : null;
    	let sundayPremierEventDate = (today.getTime() < tuesdayMorning) ? new Date(2022, 6, 3, 14) : new Date(2022, 6, 10, 14);
    	dict[7] = [sundayPremierEventDate, sunday7AmFallback];
    	dict[30] = [new Date(2022, 6, 4, 13), null];
    	dict[134] = [new Date(2022, 6, 8, 21), null];
    	dict[151] = [new Date(2022, 6, 2, 14), null];
    	dict[145] = [new Date(2022, 6, 9, 8), null];
    	return dict;
    }
    
    function areConsecutiveOrSame(date1, date2) {
		return isSameDayOrJustAfter(date1, date2) || isSameDayOrJustAfter(date2, date1);
	}
	
	function isSameDayOrJustAfter(date1, date2) {
		return (date1 <= date2) && (date2 <= (new Date(date1)).setDate(date1.getDate() + 2));
	}
	
	function isPremier(event) {
		return event.includes("Qualifier") || event.includes("Showcase") || event.includes("Open");
	}
	
	function generateTextboxForDay(today, fallbacks) {
     	let color = (today.getDay() == 0 || today.getDay() == 6) ? "blue" : "black"; // blue indicates weekend
     	let suffix = "th";
     	if (today.getDate() % 20 == 1 || today.getDate() == 31) {
     		suffix = "st";
     	} else if (today.getDate() % 20 == 2) {
     		suffix = "nd";
     	} else if (today.getDate() % 20 == 3) {
     		suffix = "rd";
     	}
		const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
		return "<fieldset style=\"border: 1px " + color + " solid; display: inline-block; min-width: 280px;\">"
     			+ "<legend style=\"border: 1px " + color + " solid;margin-left: 1em; border-radius: 15px; padding: 0.2em 0.8em \">"
     			+ days[today.getDay()] + " " + today.getDate() + suffix + "</legend>"
     			+ getScheduleForDay(today, fallbacks)
     			+ "</fieldset>";
	}
	
	function setUpFaqModal() {
		var modal = document.getElementById("faq");
    	var button = document.getElementById("info");
   		var span = document.getElementsByClassName("close")[0];

    	button.onclick = function() { modal.style.display = "block"; };
    	span.onclick = function() { modal.style.display = "none"; };
    	window.onclick = function(event) { if(event.target == modal) { modal.style.display = "none"; }};
	}
   </script>
  </body>
</html>